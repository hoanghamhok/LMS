services:
  sqlserver:
    image: mcr.microsoft.com/mssql/server:2022-latest
    environment:
      - SA_PASSWORD=Your_strong_password123
      - ACCEPT_EULA=Y
    ports: ["1433:1433"]

  rabbitmq:
    image: rabbitmq:3-management
    ports: ["5672:5672","15672:15672"]

  minio:
    image: minio/minio
    command: server /data --console-address ":9001"
    environment:
      - MINIO_ROOT_USER=minio
      - MINIO_ROOT_PASSWORD=minio123
    ports: ["9000:9000","9001:9001"]

  gateway:
    build: 
      context: ../gateway
      dockerfile: Dockerfile
    ports: ["8080:8080"]
    depends_on: [identity]

  identity:
    build: ../services/identity-service
    environment:
      - ConnectionStrings__Default=Server=sqlserver;Database=Lms.Identity;User=sa;Password=Your_strong_password123;TrustServerCertificate=True
      - Jwt__Key=ypceUw1CQAK89gqJMp8ON1L6f/lVEZPzddCfGFQAAB7g9ElC8e+m9igVx9/npmYP/jmk+/+Z7ixwedcAuSsc0g==
    depends_on: [sqlserver]
  frontend:
    build:
      context: ../frontend
      dockerfile: Dockerfile
    environment:
      - NEXT_PUBLIC_API_BASE=http://localhost:8080/api
    ports:
      - "3000:3000"
    depends_on:
      - gateway
